<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width; initial-scale=1.0" />

		<title>Kahlan - The PHP Test Framework for Freedom, Truth, and Justice</title>

		<meta name="description" content="Test framework for PHP 5.4+" />
		<meta name="author" content="CrysaLEAD, Craftsmen" />

		<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans+Narrow" />
		<link rel="stylesheet" href="css/prettify.css" />
		<link rel="stylesheet" href="css/styles.css" />
	</head>

	<body onload="prettyPrint()">
		<div>
			<a href="http://github.com/crysalead/kahlan" class="github" target="_blank">
				<img src="img/github.png" alt="Fork me on GitHub">
			</a>
			<div class="main">
				<header>
					<h1><span class="blue">K</span>ahlan - The PHP Test Framework</h1>
					<div class="baseline">— for Freedom, Truth, and Justice —</div>
				</header>
				<aside class="menu">
					<ul>
						<li>
							<a href="index.html">Why Use This ?</a>
						</li>
						<li>
							<a href="overview.html">Overview</a>
						</li>
						<li>
							<a href="start.html">Getting Started</a>
						</li>
						<li>
							<a href="matcher.html">Matchers</a>
						</li>
						<li>
							<a href="stub.html">Stubs</a>
						</li>
						<li>
							<a class="active" href="monkey.html">Monkey Patching</a>
						</li>
						<li>
							<a href="reporter.html">Reporters</a>
						</li>
						<li>
							<a href="tips.html">Pro tips</a>
						</li>
					</ul>
				</aside>
				<section class="code">

					<h2>Monkey Patching</h2>
					<p>
						To enable <strong>Monkey Patching</strong> add the following use statement in the top of your tests:
					</p>
<pre class="prettyprint">
use kahlan\plugin\Monkey;
</pre>
					<p>
						Monkey Patching allows replacement of core functions/classes which can't be stubbed like <code>time()</code>, <code>DateTime</code> or <code>MongoId</code> for example.
					</p>
					<p>
						With kahlan you can patch anything using <code>Monkey::patch()</code>
					</p>
					<p>
						For example I have the following class which need to be patched:
					</p>
<pre class="prettyprint">
namespace kahlan\monkey;

use DateTime;

class Foo {

	public function time() {
		return time();
	}

	public function datetime($datetime = 'now') {
		return new DateTime($datetime);
	}
}
</pre>
					<p>
						You can patch the <code>time()</code> function on the fly like in the following spec:
					</p>
<pre class="prettyprint">
namespace spec;

use kahlan\monkey\Foo;

function mytime() {
	return 245026800;
}

describe("Monkey::patch", function() {
	it("patches a core function", function() {
		$foo = new Foo();
		Monkey::patch('time', 'spec\mytime');
		expect($foo->time())->toBe(245026800);
	});
});
</pre>
					<p>
						Unbelivable right ? Moreover you can also replace the <code>time()</code> function by a simple closure:
					</p>
<pre class="prettyprint">
it("patches a core function with a closure", function() {
	$foo = new Foo();
	Monkey::patch('time', function(){return 123;});
	expect($foo->time())->toBe(123);
});
</pre>

					<p>
						Using the same syntax, you can also patch any core classes or PHP classes by just patching a fully namepaced classname to another fully namepaced classname.
					</p>
				</section>
			</div>
		</div>

		<script type="text/javascript" src="js/prettify.js"></script>
	</body>
</html>
